#!/usr/bin/env perl

use strict;
use warnings;

my $fasta_dir = "$ENV{PWD}/fasta";

my $chr_details = [
	#[Chromsome,Start,End,Regionlength],
	["1",121757251,299554001,177796750],
	["2",10001,16144751,16134750],
	["3",10001,16814001,16804000],
	["4",1441751,8797251,7355500],
	["5",10001,17530501,17520500],
	["6",60001,58453751,58393750],
	["7",240251,58119501,57879250],
	["8",60001,7617001,7557000],
	["9",10001,40529251,40519250],
	["10",10001,38529751,38519750],
	["11",60001,50821251,50761250],
	["12",10001,6801501,6791500],
	["13",18408251,86202751,67794500],
	["14",19631251,106883501,87252250],
	["15",27346501,84253001,56906500],
	["16",10001,18436251,18426250],
	["17",513251,21795501,21282250],
	["18",39251,15404501,15365250],
	["19",78751,24410501,24331750],
	["20",78751,26346001,26267250],
	["21",12995251,31757501,18762250],
	["22",15167751,16279501,1111750],
	["X",236751,1949001,1712250],
	["Y",2804251,9045001,6240750]
];

for my $chr_det (@{$chr_details}) {
  my ($name, $start, $end, $length) = @{$chr_det};
  my $offset = 100000;
  my $sub_start = $start;
  my $sub_end = $start+$offset;
  my $attempts = 0;
  while($attempts < 100) {
    my $seq = `samtools faidx ${fasta_dir}/${name}.fa ${name}:$sub_start-$sub_end`; #small_fasta/${name}.fa
    if($seq =~ /n/i) {
      $attempts++;
      next;
    }
    open my $fh, '>', "small_fasta/${name}.fa" or die "Cannot open fasta file: $!";
    print $fh $seq;
    close $fh;
    last;
  }
}
